!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("vueAtTextarea",[],t):"object"==typeof exports?exports.vueAtTextarea=t():e.vueAtTextarea=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=6)}([function(e,t){function r(e,t){var r=e[1]||"",o=e[3];if(!o)return r;if(t&&"function"==typeof btoa){var a=n(o);return[r].concat(o.sources.map(function(e){return"/*# sourceURL="+o.sourceRoot+e+" */"})).concat([a]).join("\n")}return[r].join("\n")}function n(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=r(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},o=0;o<this.length;o++){var a=this[o][0];"number"==typeof a&&(n[a]=!0)}for(o=0;o<e.length;o++){var i=e[o];"number"==typeof i[0]&&n[i[0]]||(r&&!i[2]?i[2]=r:r&&(i[2]="("+i[2]+") and ("+r+")"),t.push(i))}},t}},function(e,t,r){function n(e){for(var t=0;t<e.length;t++){var r=e[t],n=d[r.id];if(n){n.refs++;for(var o=0;o<n.parts.length;o++)n.parts[o](r.parts[o]);for(;o<r.parts.length;o++)n.parts.push(a(r.parts[o]));n.parts.length>r.parts.length&&(n.parts.length=r.parts.length)}else{for(var i=[],o=0;o<r.parts.length;o++)i.push(a(r.parts[o]));d[r.id]={id:r.id,refs:1,parts:i}}}}function o(){var e=document.createElement("style");return e.type="text/css",l.appendChild(e),e}function a(e){var t,r,n=document.querySelector("style["+v+'~="'+e.id+'"]');if(n){if(h)return m;n.parentNode.removeChild(n)}if(g){var a=f++;n=p||(p=o()),t=i.bind(null,n,a,!1),r=i.bind(null,n,a,!0)}else n=o(),t=s.bind(null,n),r=function(){n.parentNode.removeChild(n)};return t(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;t(e=n)}else r()}}function i(e,t,r,n){var o=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=x(t,o);else{var a=document.createTextNode(o),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(a,i[t]):e.appendChild(a)}}function s(e,t){var r=t.css,n=t.media,o=t.sourceMap;if(n&&e.setAttribute("media",n),b.ssrId&&e.setAttribute(v,t.id),o&&(r+="\n/*# sourceURL="+o.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var u="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!u)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var c=r(10),d={},l=u&&(document.head||document.getElementsByTagName("head")[0]),p=null,f=0,h=!1,m=function(){},b=null,v="data-vue-ssr-id",g="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());e.exports=function(e,t,r,o){h=r,b=o||{};var a=c(e,t);return n(a),function(t){for(var r=[],o=0;o<a.length;o++){var i=a[o],s=d[i.id];s.refs--,r.push(s)}t?(a=c(e,t),n(a)):a=[];for(var o=0;o<r.length;o++){var s=r[o];if(0===s.refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete d[s.id]}}}};var x=function(){var e=[];return function(t,r){return e[t]=r,e.filter(Boolean).join("\n")}}()},function(e,t){e.exports=function(e,t,r,n,o,a){var i,s=e=e||{},u=typeof e.default;"object"!==u&&"function"!==u||(i=e,s=e.default);var c="function"==typeof s?s.options:s;t&&(c.render=t.render,c.staticRenderFns=t.staticRenderFns,c._compiled=!0),r&&(c.functional=!0),o&&(c._scopeId=o);var d;if(a?(d=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},c._ssrRegister=d):n&&(d=n),d){var l=c.functional,p=l?c.render:c.beforeCreate;l?(c._injectStyles=d,c.render=function(e,t){return d.call(t),p(e,t)}):c.beforeCreate=p?[].concat(p,d):[d]}return{esModule:i,exports:s,options:c}}},function(e,t,r){"use strict";var n=r(11),o=r.n(n),a=r(12),i=r(5),s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.a={name:"VueAtTextarea",components:{atUserPopup:a.a},props:{value:{type:String,default:""},members:{type:Array,required:!0,default:function(){return[]}},memberFilter:{type:Function,default:function(e,t){return e[this.rowProps.name].toLowerCase().indexOf(t.toLowerCase())>-1}},autofocus:{type:Boolean,default:!0},rowProps:{type:Object,default:function(){return{id:"ID",name:"Name",avatar:"Avatar"}}},disabled:{type:Boolean,default:!1}},provide:function(){return{rootTextarea:this}},watch:{value:{immediate:!0,handler:function(e){this.content=e}},members:{immediate:!0,handler:function(e){this.visible=!1}},content:{immediate:!0,handler:function(e){this.$emit("input",e),this.$emit("change",{value:e,matchedAtNames:this.matchedAtNameArr,matchedAtUsers:this.matchedAtUsersArr})}}},computed:{matchedAtNameArr:function(){var e=this.content.match(this.matchAtReg);return e?Array.from(new Set(e)):[]},matchedAtUsersArr:function(){var e=this,t=[],r=this.members,n=this.matchedAtNameArr;return n&&n.forEach(function(n){for(var o=0;o<r.length;o++)if(n.includes(r[o][e.rowProps.name])){JSON.stringify(t).includes(r[o][e.rowProps.name])||t.push(r[o]);break}}),t}},data:function(){return{content:"",visible:!1,matchAtReg:/(@\S{1,}?) /g,atMark:"@",matchedMembers:[],lastCursorPos:{text:"",start:0,end:0},atInfo:{left:0,top:0,height:NaN}}},methods:{handleBlur:function(e){this.getCursorPosition(e.target)},handleKeyDown:function(e){this.getCursorPosition(e.target),this.visible&&(38!==e.keyCode&&40!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),e.stopPropagation(),this.$refs.popup.handleKeyDown(e)),37!==e.keyCode&&39!==e.keyCode||(e.preventDefault(),e.stopPropagation()))},handleInput:function(e){var t=this,r=e.target,n=r.value.slice(0,r.selectionEnd),o=!0;if(n){var a=Object(i.a)(n,this.atMark),s=a.at,u=a.index;u<0&&(o=!1);var c=n.slice(u+s.length,n.length),d=this.members.filter(function(e){return t.memberFilter(e,c)});d.length&&o?this.openPopUp(r,d,u):this.closePopUp()}else this.closePopUp()},openPopUp:function(e,t,r){this.matchedMembers=t;var n=r+1;this.atInfo=s({},o()(e,n),{atCharIndex:r}),this.visible=!0},closePopUp:function(){this.visible=!1},insertValue:function(e){var t=this.$refs.textarea,r=t.value.slice(0,this.lastCursorPos.start),n=t.value.slice(this.lastCursorPos.end),o=r+e+n;this.content=o},handleAtUser:function(e){var t=e[this.rowProps.name]+" ",r=this.$refs.textarea,n=this.atInfo.atCharIndex+1,o=r.selectionEnd,a=r.value.slice(0,n)+t+r.value.slice(o),i=n+t.length;this.content=a,r.selectionStart=i,r.selectionEnd=i,this.visible=!1},getCursorPosition:function(e){this.lastCursorPos=Object(i.b)(e)}}}},function(e,t,r){"use strict";var n=r(5);t.a={inject:["rootTextarea"],props:{members:{type:Array,default:function(){return[]}},visible:{type:Boolean,default:!1},atInfo:{type:Object,default:function(){return{left:0,top:0,height:NaN}}},rowProps:{type:Object,default:function(){return{id:"ID",name:"Name",avatar:"Avatar"}}}},computed:{style:function(){return"\n        left: "+this.offset.left+"px;\n        top: "+this.offset.top+"px;\n      "},totalMembers:function(){return Array.isArray(this.members)?this.members.length:0}},watch:{atInfo:{deep:!0,immediate:!0,handler:function(){this.refreshOffset()}},members:{deep:!0,immediate:!0,handler:function(){this.current=0}},visible:{handler:function(e){e&&(this.current=0)}},current:{handler:function(e){var t=this.$refs.member;t[e]&&Object(n.c)(t[e],this.$refs.popup)}}},data:function(){return{offset:{left:0,top:0},current:0}},methods:{refreshOffset:function(){var e=this,t=this.atInfo,r=t.top,n=t.left;this.$nextTick(function(){var t=e.$parent.$el,o=t.querySelector(".at-user-popup"),a=t.querySelector("textarea"),i=o?o.offsetHeight:0,s=a?a.scrollTop:0;e.offset={top:r-i-s-20,left:n-30}})},handleSelected:function(e){this.$emit("atUser",e)},handleMouseEnter:function(e){this.current=e},handleKeyDown:function(e){if(38===e.keyCode||40===e.keyCode)return void(e.metaKey||e.ctrlKey||(e.preventDefault(),e.stopPropagation(),this.selectByKeyboard(e)));13===e.keyCode&&this.handleSelected(this.members[this.current])},selectByKeyboard:function(e){var t=38===e.keyCode?-1:1;-1===t?this.current>0?this.current+=t:this.current=this.totalMembers-1:1===t&&(this.current===this.totalMembers-1?this.current=0:this.current+=t)}}}},function(e,t,r){"use strict";function n(e){var t={text:"",start:0,end:0};if(e.focus(),e.setSelectionRange)t.start=e.selectionStart,t.end=e.selectionEnd,t.text=t.start!=t.end?e.value.substring(t.start,t.end):"";else if(document.selection){var r,n=document.selection.createRange(),o=document.body.createTextRange();for(o.moveToElementText(e),t.text=n.text,t.bookmark=n.getBookmark(),r=0;o.compareEndPoints("StartToStart",n)<0&&0!==n.moveStart("character",-1);r++)"\n"==e.value.charAt(r)&&r++;t.start=r,t.end=t.text.length+t.start}return t}function o(e,t){return{at:t,index:e.lastIndexOf(t)}}function a(e,t){if(e.scrollIntoViewIfNeeded)e.scrollIntoViewIfNeeded(!1);else{var r=e.offsetTop-t.scrollTop;(r<0||r>t.offsetHeight-e.offsetHeight)&&(t=t||e.parentElement,t.scrollTop=e.offsetTop)}}t.b=n,t.a=o,t.c=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(7);r.d(t,"VueAtTextarea",function(){return n.a});var o={install:function(e){e.component(n.a.name,n.a)}};"undefined"!=typeof window&&window.Vue&&window.Vue.use(o),t.default=o},function(e,t,r){"use strict";function n(e){r(8)}var o=r(3),a=r(16),i=r(2),s=n,u=i(o.a,a.a,!1,s,"data-v-cb42ef0c",null);t.a=u.exports},function(e,t,r){var n=r(9);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);r(1)("6b92821c",n,!0,{})},function(e,t,r){t=e.exports=r(0)(!1),t.push([e.i,".chat-textarea[data-v-cb42ef0c]{position:absolute;top:0;left:0;right:0;bottom:0}.chat-textarea .chat-textarea-input[data-v-cb42ef0c]{width:100%;height:100%;padding:10px 15px;resize:none;outline:none;border:none;box-sizing:border-box;font-size:14px;font-family:Helvetica Neue,Helvetica,PingFang SC,Hiragino Sans GB,Microsoft YaHei,\\\\5FAE\\8F6F\\96C5\\9ED1,Arial,sans-serif}",""])},function(e,t){e.exports=function(e,t){for(var r=[],n={},o=0;o<t.length;o++){var a=t[o],i=a[0],s=a[1],u=a[2],c=a[3],d={id:e+":"+o,css:s,media:u,sourceMap:c};n[i]?n[i].parts.push(d):r.push(n[i]={id:i,parts:[d]})}return r}},function(e,t){!function(){function t(e,t,a){if(!n)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var i=a&&a.debug||!1;if(i){var s=document.querySelector("#input-textarea-caret-position-mirror-div");s&&s.parentNode.removeChild(s)}var u=document.createElement("div");u.id="input-textarea-caret-position-mirror-div",document.body.appendChild(u);var c=u.style,d=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,l="INPUT"===e.nodeName;c.whiteSpace="pre-wrap",l||(c.wordWrap="break-word"),c.position="absolute",i||(c.visibility="hidden"),r.forEach(function(e){l&&"lineHeight"===e?c.lineHeight=d.height:c[e]=d[e]}),o?e.scrollHeight>parseInt(d.height)&&(c.overflowY="scroll"):c.overflow="hidden",u.textContent=e.value.substring(0,t),l&&(u.textContent=u.textContent.replace(/\s/g," "));var p=document.createElement("span");p.textContent=e.value.substring(t)||".",u.appendChild(p);var f={top:p.offsetTop+parseInt(d.borderTopWidth),left:p.offsetLeft+parseInt(d.borderLeftWidth),height:parseInt(d.lineHeight)};return i?p.style.backgroundColor="#aaa":document.body.removeChild(u),f}var r=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],n="undefined"!=typeof window,o=n&&null!=window.mozInnerScreenX;void 0!==e&&void 0!==e.exports?e.exports=t:n&&(window.getCaretCoordinates=t)}()},function(e,t,r){"use strict";function n(e){r(13)}var o=r(4),a=r(15),i=r(2),s=n,u=i(o.a,a.a,!1,s,"data-v-6bdb7668",null);t.a=u.exports},function(e,t,r){var n=r(14);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);r(1)("5af18578",n,!0,{})},function(e,t,r){t=e.exports=r(0)(!1),t.push([e.i,".at-user-popup[data-v-6bdb7668]{position:absolute;top:0;width:200px;max-height:220px;border-radius:6px;border:1px solid #eee;background:#fff;overflow:hidden;overflow-y:auto;box-shadow:0 4px 6px 0 hsla(0,0%,77%,.2)}.at-user-popup[data-v-6bdb7668]::-webkit-scrollbar{height:0;background:none;width:0;height:6px}.at-user-popup[data-v-6bdb7668]::-webkit-scrollbar-track{background:hsla(0,0%,100%,0);border-radius:6px}.at-user-popup[data-v-6bdb7668]::-webkit-scrollbar-thumb{border-radius:6px;transition:all .2s}.at-user-popup[data-v-6bdb7668]:hover::-webkit-scrollbar-thumb{background:#c9c9ca}.at-user-popup[data-v-6bdb7668]{scrollbar-arrow-color:#c0c4cc;scrollbar-face-color:#a2a2a3;scrollbar-highlight-color:#a2a2a3;scrollbar-shadow-color:#a2a2a3;scrollbar-track-color:#f4f4f5;scrollbar-3dlight-color:#a2a2a3;scrollbar-darkshadow-color:#a2a2a3;scrollbar-base-color:#f4f4f5}.at-user-popup .at-user-popup-item[data-v-6bdb7668]{padding:8px 10px;border-bottom:1px dashed #eee;display:flex;align-items:center;cursor:pointer}.at-user-popup .at-user-popup-item[data-v-6bdb7668]:last-child{border:none}.at-user-popup .at-user-popup-item.current[data-v-6bdb7668]{background:#485eeb;color:#fff;border-bottom:1px solid #485eeb}.at-user-popup .at-user-popup-item .at-user-popup-item-avatar[data-v-6bdb7668]{width:25px;height:25px;border-radius:25px;display:block;object-fit:cover;overflow:hidden}.at-user-popup .at-user-popup-item .at-user-popup-item-name[data-v-6bdb7668]{font-size:14px;flex:1;padding-left:10px;display:flex;align-items:center}.at-user-popup .at-user-popup-item .at-user-popup-item-name span[data-v-6bdb7668]{display:block;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical}",""])},function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.visible?r("div",{ref:"popup",staticClass:"at-user-popup",style:e.style},e._l(e.members,function(t,n){return r("div",{key:t.ID,ref:"member",refInFor:!0,class:["at-user-popup-item",{current:n===e.current}],attrs:{"data-index":n},on:{mouseenter:function(r){return e.handleMouseEnter(n,t)},click:function(r){return e.handleSelected(t)}}},[r("img",{staticClass:"at-user-popup-item-avatar",attrs:{src:t[e.rowProps.avatar]}}),e._v(" "),r("div",{staticClass:"at-user-popup-item-name"},[r("span",{domProps:{textContent:e._s(t[e.rowProps.name])}})])])}),0):e._e()},o=[],a={render:n,staticRenderFns:o};t.a=a},function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"chat-textarea"},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.content,expression:"content"}],ref:"textarea",staticClass:"chat-textarea-input",attrs:{disabled:e.disabled,autofocus:e.autofocus},domProps:{value:e.content},on:{blur:e.handleBlur,keydown:e.handleKeyDown,input:[function(t){t.target.composing||(e.content=t.target.value)},e.handleInput]}}),e._v(" "),r("at-user-popup",{ref:"popup",attrs:{visible:e.visible,members:e.matchedMembers,"at-info":e.atInfo,"row-props":e.rowProps},on:{atUser:e.handleAtUser}})],1)},o=[],a={render:n,staticRenderFns:o};t.a=a}])});
//# sourceMappingURL=vue-at-textarea.js.map